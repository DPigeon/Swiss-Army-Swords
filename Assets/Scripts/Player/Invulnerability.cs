using UnityEngine;
using System.Collections;

public class Invulnerability : MonoBehaviour
{
    private Renderer r;
    private Color c;
    private GameObject[] enemy;
    private Player player;
    private HitpointBar playerHPBar;

    void Start()
    {
        r = GetComponent<Renderer>();
        c = r.material.color;
        player = GameObject.FindGameObjectWithTag("Player").GetComponent<Player>();
        playerHPBar = GameObject.Find("HitpointBar").GetComponent<HitpointBar>();
    }

    private void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.tag.Equals("Enemy") && playerHPBar.PlayerHealth >= 0) // is dead at 0.
        {
            StartCoroutine(GetInvulnerability());
        }
    }

    private void OnTriggerExit2D(Collider2D collision)
    {
        if (collision.tag.Equals("Enemy") && playerHPBar.PlayerHealth >= 0) // is dead at 0.
        {
            Knockback(collision);
        }
    }

    private IEnumerator GetInvulnerability()
    {
        player.IsHurt = true;
        //Physics2D.IgnoreLayerCollision(10, 11, true);
        //playerHPBar.DecreaseHitpoint(1);
        yield return new WaitForSeconds(3f);
        //Physics2D.IgnoreLayerCollision(10, 11, false);
        player.IsHurt = false;
    }

    private void Knockback(Collider2D monster)
    {
        Vector3 moveDirection = player.PlayerRigidBody().transform.position - monster.gameObject.transform.position;
        player.PlayerRigidBody().AddForce(moveDirection.normalized * 100f);
    }
}


